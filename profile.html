<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>Profile - SY BAF</title>
Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
Â  <style>
Â  Â  :root {
Â  Â  Â  --bg: #f2f2f2;
Â  Â  Â  --text: #111;
Â  Â  Â  --card: #fff;
Â  Â  Â  --highlight: #b84fff;
Â  Â  Â  --profile-border: black;
Â  Â  }
Â  Â  [data-theme="dark"] {
Â  Â  Â  --bg: #1e1e2e;
Â  Â  Â  --text: white;
Â  Â  Â  --card: #2a2a3d;
Â  Â  Â  --profile-border: white;
Â  Â  }

Â  Â  * {
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  transition: background-color 0.3s, color 0.3s;
Â  Â  }

Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  background-color: var(--bg);
Â  Â  Â  color: var(--text);
Â  Â  }

Â  Â  .top-bar {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  padding: 12px 20px;
Â  Â  Â  background-color: var(--card);
Â  Â  Â  position: sticky;
Â  Â  Â  top: 0;
Â  Â  Â  z-index: 10;
Â  Â  }

Â  Â  .top-bar h1 {
Â  Â  Â  margin: 0;
Â  Â  Â  font-size: 18px;
Â  Â  Â  flex: 1;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  .menu-toggle {
Â  Â  Â  font-size: 24px;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  .profile-container {
Â  Â  Â  max-width: 600px;
Â  Â  Â  margin: auto;
Â  Â  Â  padding: 20px;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  .profile-pic {
Â  Â  Â  width: 120px;
Â  Â  Â  height: 120px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  border: 3px solid var(--profile-border);
Â  Â  Â  object-fit: cover;
Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  .name {
Â  Â  Â  font-size: 20px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 6px;
Â  Â  }

Â  Â  .name img {
Â  Â  Â  width: 18px;
Â  Â  Â  height: 18px;
Â  Â  }

Â  Â  .role {
Â  Â  Â  font-size: 14px;
Â  Â  Â  color: var(--highlight);
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  .stats {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-around;
Â  Â  Â  margin-top: 20px;
Â  Â  Â  padding: 10px 0;
Â  Â  Â  border-top: 1px solid rgba(0,0,0,0.1);
Â  Â  Â  border-bottom: 1px solid rgba(0,0,0,0.1);
Â  Â  }

Â  Â  .stats div {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  }

Â  Â  .stats .number {
Â  Â  Â  font-size: 22px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: var(--highlight);
Â  Â  }

Â  Â  .stats .label {
Â  Â  Â  font-size: 14px;
Â  Â  Â  font-style: italic;
Â  Â  }

Â  Â  .info-section {
Â  Â  Â  text-align: left;
Â  Â  Â  margin-top: 30px;
Â  Â  Â  padding: 0 20px;
Â  Â  }

Â  Â  .info-box {
Â  Â  Â  background-color: var(--card);
Â  Â  Â  padding: 15px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  margin-bottom: 12px;
Â  Â  Â  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
Â  Â  }

Â  Â  .info-title {
Â  Â  Â  font-size: 12px;
Â  Â  Â  color: #888;
Â  Â  Â  margin-bottom: 5px;
Â  Â  }

Â  Â  .info-value {
Â  Â  Â  font-size: 16px;
Â  Â  Â  font-weight: 500;
Â  Â  Â  word-break: break-word;
Â  Â  }

Â  Â  .back-button {
Â  Â  Â  margin-top: 30px;
Â  Â  Â  background-color: var(--highlight);
Â  Â  Â  border: none;
Â  Â  Â  color: white;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  .sidebar {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: -250px;
Â  Â  Â  width: 250px;
Â  Â  Â  height: 100%;
Â  Â  Â  background-color: var(--card);
Â  Â  Â  padding: 20px;
Â  Â  Â  box-shadow: 2px 0 10px rgba(0,0,0,0.3);
Â  Â  Â  transition: left 0.3s;
Â  Â  Â  z-index: 20;
Â  Â  }

Â  Â  .sidebar.active {
Â  Â  Â  left: 0;
Â  Â  }

Â  Â  .close-sidebar {
Â  Â  Â  text-align: right;
Â  Â  Â  font-size: 18px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }

Â  Â  .sidebar nav a {
Â  Â  Â  display: block;
Â  Â  Â  color: var(--text);
Â  Â  Â  text-decoration: none;
Â  Â  Â  padding: 10px 0;
Â  Â  Â  border-bottom: 1px solid rgba(0,0,0,0.1);
Â  Â  }

Â  Â  .sidebar nav a:hover {
Â  Â  Â  color: var(--highlight);
Â  Â  }

Â  Â  .logout, .theme-toggle {
Â  Â  Â  margin-top: 20px;
Â  Â  Â  background-color: red;
Â  Â  Â  border: none;
Â  Â  Â  color: white;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  width: 100%;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  .theme-toggle {
Â  Â  Â  background-color: var(--highlight);
Â  Â  Â  margin-top: 10px;
Â  Â  }

Â  Â  /* New QR Code styles */
Â  Â  .qr-code-box {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  margin-top: 20px;
Â  Â  }
Â  Â Â 
Â  Â  .qr-code-container {
Â  Â  Â  padding: 10px;
Â  Â  Â  background-color: var(--card);
Â  Â  Â  border-radius: 8px;
Â  Â  Â  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
Â  Â  }
Â  Â Â 
Â  Â  .qr-code-container img {
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  padding: 5px;
Â  Â  Â  border-radius: 5px;
Â  Â  }
Â  Â Â 
Â  Â  @media (max-width: 480px) {
Â  Â  Â  .qr-code-container {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  }
Â  Â  }
Â  </style>
</head>
<body data-theme="light">

Â  <div class="sidebar" id="sidebar">
Â  Â  <div class="close-sidebar" onclick="toggleSidebar()">âœ–</div>
Â  Â  <nav>
Â  Â  Â  <a href="Home.html">ğŸ  Home</a>
Â  Â  Â  <a href="timetable.html">ğŸ•’ Time Table</a>
Â  Â  Â  <a href="subjects.html">ğŸ“š Subjects</a>
Â  Â  Â  <a href="about.html">â„¹ï¸ About Us</a>
Â  Â  Â  <a href="help.html">â“ Help</a>
Â  Â  </nav>
Â  Â  <button class="theme-toggle" onclick="toggleTheme()">Switch Theme</button>
Â  Â  <button class="logout" onclick="logout()">Logout</button>
Â  </div>

Â  <div class="top-bar">
Â  Â  <div class="menu-toggle" onclick="toggleSidebar()">â˜°</div>
Â  Â  <h1>Profile</h1>
Â  Â  <div style="width:24px;"></div>
Â  </div>

Â  <div class="profile-container">
Â  Â  <div style="position: relative; display: inline-block;">
Â  Â  Â  <img src="https://t4.ftcdn.net/jpg/05/89/93/27/360_F_589932782_vQAEAZhHnq1QCGu5ikwrYaQD0Mmurm0N.jpg" alt="Profile Picture" class="profile-pic" id="profilePic">
Â  Â  </div>
Â  Â  <input type="file" id="uploadInput" accept="image/*" style="display: none" onchange="changeProfilePicture(event)">

Â  Â  <div class="name" id="studentName">Loading...</div>
Â  Â  <div class="role" id="roleText">Role</div>

Â  Â  <div class="stats">
Â  Â  Â  <div><div class="number" id="confessCount">--</div><div class="label">Confesses</div></div>
Â  Â  Â  <div><div class="number" id="rollNo">--</div><div class="label">Roll No.</div></div>
Â  Â  Â  <div><div class="number" id="classTotal">127</div><div class="label">Class Total</div></div>
Â  Â  </div>

Â  Â  <div class="info-section">
Â  Â  Â  <div class="info-box"><div class="info-title">Student ID</div><div class="info-value" id="studentId">--</div></div>
Â  Â  Â  <div class="info-box"><div class="info-title">Mobile</div><div class="info-value" id="mobile">--</div></div>
Â  Â  Â  <div class="info-box"><div class="info-title">Email</div><div class="info-value" id="email">--</div></div>
Â  Â  Â  <div class="info-box"><div class="info-title">Instagram ID</div><div class="info-value" id="insta">--</div></div>
Â  Â  Â Â 
Â  Â  Â  <div class="info-box qr-code-box">
Â  Â  Â  Â  <div class="info-title">Student QR Code</div>
Â  Â  Â  Â  <div class="qr-code-container" id="qrCodeContainer"></div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  </div>

Â  Â  <button class="back-button" onclick="history.back()">â† Go Back</button>
Â  </div>

Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.jsdelivr.net/gh/kazuhikoarase/qrcode-generator/qrcode.min.js"></script>
Â  <script>
Â  Â  const SUPABASE_URL = 'https://fuovcuzaxfkyqrridrgy.supabase.co';
Â  Â  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1b3ZjdXpheGZreXFycmlkcmd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NzIyMjAsImV4cCI6MjA2MTA0ODIyMH0._PkkfWXcn4j6cjBh-yLJjDevrmhuxKxVbcdQUSgCsSk';
Â  Â  const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

Â  Â  function getCookie(name) {
Â  Â  Â  const value = `; ${document.cookie}`;
Â  Â  Â  const parts = value.split(`; ${name}=`);
Â  Â  Â  if (parts.length === 2) return parts.pop().split(";").shift();
Â  Â  }

Â  Â  function toggleSidebar() {
Â  Â  Â  document.getElementById('sidebar').classList.toggle('active');
Â  Â  }

Â  Â  function toggleTheme() {
Â  Â  Â  const body = document.body;
Â  Â  Â  const newTheme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
Â  Â  Â  body.setAttribute('data-theme', newTheme);
Â  Â  Â  localStorage.setItem('theme', newTheme);
Â  Â  }

Â  Â  function logout() {
Â  Â  Â  document.cookie = "roll=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
Â  Â  Â  window.location.href = "https://bafbkbnc.github.io/BAFs/login.html";
Â  Â  }

Â  Â  function generateQRCode(text, containerId) {
Â  Â  Â  const container = document.getElementById(containerId);
Â  Â  Â  if (!container) return;

Â  Â  Â  const typeNumber = 4;
Â  Â  Â  const errorCorrectionLevel = 'M';
Â  Â  Â  const qr = qrcode(typeNumber, errorCorrectionLevel);
Â  Â  Â  qr.addData(text);
Â  Â  Â  qr.make();

Â  Â  Â  const qrImg = qr.createImgTag(5, 10);
Â  Â  Â  container.innerHTML = qrImg;
Â  Â  Â  const imgElement = container.querySelector('img');
Â  Â  Â  imgElement.style.width = '150px';
Â  Â  Â  imgElement.style.height = '150px';
Â  Â  }

Â  Â  async function loadProfile(roll) {
Â  Â  Â  const { data, error } = await client
Â  Â  Â  Â  .from('BAF')
Â  Â  Â  Â  .select('NAME, img, "ROLL", role, ID, MOB, MAIL, confesses, tick, INSTA')
Â  Â  Â  Â  .eq('"ROLL"', roll)
Â  Â  Â  Â  .single();

Â  Â  Â  if (data) {
Â  Â  Â  Â  const tickUrls = {
Â  Â  Â  Â  Â  blue: "https://i.ibb.co/kgJpMCHr/blue.png",
Â  Â  Â  Â  Â  silver: "https://i.ibb.co/gLJLF9Z2/silver.png",
Â  Â  Â  Â  Â  gold: "https://i.ibb.co/Q2C7MrM/gold.png"
Â  Â  Â  Â  };

Â  Â  Â  Â  const tick = data.tick && tickUrls[data.tick.toLowerCase()] ? `<img src="${tickUrls[data.tick.toLowerCase()]}" alt="tick">` : "";

Â  Â  Â  Â  document.getElementById("studentName").innerHTML = `${data.NAME || "Unknown"} ${tick}`;
Â  Â  Â  Â  document.getElementById("profilePic").src = data.img || "https://via.placeholder.com/120";
Â  Â  Â  Â  document.getElementById("rollNo").textContent = data.ROLL || "-";
Â  Â  Â  Â  document.getElementById("roleText").textContent = data.role || "Student";
Â  Â  Â  Â  document.getElementById("studentId").textContent = data.ID || "-";
Â  Â  Â  Â  document.getElementById("mobile").textContent = data.MOB || "-";
Â  Â  Â  Â  document.getElementById("email").textContent = data.MAIL || "-";
Â  Â  Â  Â  document.getElementById("confessCount").textContent = data.confesses || "0";
Â  Â  Â  Â  document.getElementById("insta").textContent = data.INSTA || "-";

Â  Â  Â  Â  if (data.ID) {
Â  Â  Â  Â  Â  generateQRCode(data.ID, 'qrCodeContainer');
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  console.error("Error:", error);
Â  Â  Â  }
Â  Â  }

Â  Â  function setupImageEvents() {
Â  Â  Â  const profilePic = document.getElementById("profilePic");

Â  Â  Â  const viewImage = () => {
Â  Â  Â  Â  const imgUrl = profilePic.src;
Â  Â  Â  Â  window.open(imgUrl, "_blank");
Â  Â  Â  };

Â  Â  Â  let pressTimer;

Â  Â  Â  const onPressStart = () => {
Â  Â  Â  Â  pressTimer = setTimeout(viewImage, 600);
Â  Â  Â  };

Â  Â  Â  const onPressEnd = () => {
Â  Â  Â  Â  clearTimeout(pressTimer);
Â  Â  Â  };

Â  Â  Â  profilePic.addEventListener("mousedown", onPressStart);
Â  Â  Â  profilePic.addEventListener("mouseup", onPressEnd);
Â  Â  Â  profilePic.addEventListener("mouseleave", onPressEnd);
Â  Â  Â  profilePic.addEventListener("touchstart", onPressStart);
Â  Â  Â  profilePic.addEventListener("touchend", onPressEnd);

Â  Â  Â  profilePic.addEventListener("click", () => {
Â  Â  Â  Â  document.getElementById("uploadInput").click();
Â  Â  Â  });
Â  Â  }

Â  Â  async function changeProfilePicture(event) {
Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  if (!file) return;

Â  Â  Â  const fileName = `profile-${Date.now()}.jpg`;

Â  Â  Â  const { error: uploadError } = await client.storage
Â  Â  Â  Â  .from('profile-pics')
Â  Â  Â  Â  .upload(fileName, file, { cacheControl: '3600', upsert: true });

Â  Â  Â  if (uploadError) {
Â  Â  Â  Â  console.error("Upload Error:", uploadError);
Â  Â  Â  Â  return alert("Upload failed!");
Â  Â  Â  }

Â  Â  Â  const { data, error } = client.storage.from('profile-pics').getPublicUrl(fileName);

Â  Â  Â  if (error || !data || !data.publicUrl) {
Â  Â  Â  Â  console.error('Error getting public URL:', error);
Â  Â  Â  Â  return alert('Could not get public URL');
Â  Â  Â  }

Â  Â  Â  const publicURL = data.publicUrl;
Â  Â  Â  const roll = getCookie("roll");

Â  Â  Â  const { error: updateError } = await client
Â  Â  Â  Â  .from("BAF")
Â  Â  Â  Â  .update({ img: publicURL })
Â  Â  Â  Â  .eq("ROLL", roll);

Â  Â  Â  if (updateError) {
Â  Â  Â  Â  console.error("Update Error:", updateError);
Â  Â  Â  Â  return alert("Failed to update profile picture in database");
Â  Â  Â  }

Â  Â  Â  document.getElementById("profilePic").src = publicURL;
Â  Â  Â  alert("Profile picture updated!");
Â  Â  }

Â  Â  window.onload = async function () {
Â  Â  Â  const savedTheme = localStorage.getItem('theme');
Â  Â  Â  if (savedTheme) document.body.setAttribute('data-theme', savedTheme);

Â  Â  Â  const roll = getCookie("roll");
Â  Â  Â  if (!roll) return window.location.href = "https://bafbkbnc.github.io/BAFs/login.html";

Â  Â  Â  await loadProfile(roll);
Â  Â  Â  setupImageEvents();
Â  Â  };
Â  </script>
</body>
</html>
